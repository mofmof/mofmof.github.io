---
layout: blog
title: word2vecでコードネーム(ボドゲ)を解いてみたら(すげえ強かった？すげえ弱かった？)
category: blog
tags: [word2vec, 機械学習, fastText, python]
summary: コードネームで遊んでいたある瞬間にあることに気付いてしまった。word2vecを使えば、人間よりも賢く正解を選べるのではないかということに。
author: aharada
image: /images/blog/2018-02-24-codename-word2vec/codename.jpg
---
![コードネーム](/images/blog/2018-02-24-codename-word2vec/codename.jpg)

コードネームで遊んでいたある瞬間にあることに気付いてしまった。word2vecを使えば、人間よりも賢く正解を選べるのではないかということに。

[コードネーム](https://www.amazon.co.jp/%E3%83%9B%E3%83%93%E3%83%BC%E3%82%B8%E3%83%A3%E3%83%91%E3%83%B3-HobbyJAPAN-%E3%82%B3%E3%83%BC%E3%83%89%E3%83%8D%E3%83%BC%E3%83%A0-%E6%97%A5%E6%9C%AC%E8%AA%9E%E7%89%88/dp/B019SZ30BI
)というのは今mofmof inc.で少し流行っているボドゲなんですが、超簡単に説明すると、それぞれ単語が書かれた25枚のカードを並べて、マスターが単語一つのヒントを言って、他プレイヤーはそのヒントから連想されるカードを当てるルールで、2チームに分かれて戦うゲームです。

word2vecとは、超簡単に説明すると、単語をベクトル化する手法のことです。自然言語処理とか機械学習とかする際に、コンピューターは文字列を直接計算することは出来ないので、数値の行列で表現された値(ベクトル)に変換したい。そういうシーンに使う技術ですね。

word2vecを使えば、意味の近い単語は、ベクトルも近くなります。単語のベクトル同士を比較して検索すれば、マスターが言ったヒントに対して、連想される単語を解くことが出来るのではないか？と考えたわけです。

早速やってみましょう。

## pythonのバージョンを最新にする

別に最新にしなくてもいいのですが、久々に触るのでpython最新バージョンにしておく。`pyenv install --list`に3.6系が表示されなかったので`pyenv`自体をアップグレードした。

```
$ brew update && brew upgrade pyenv
$ pyenv install 3.6.3
```

## 単純に単語間の距離を図れる実装をする

まずは簡単に単語ベクトル間の類似度を計算する処理を実装。未知の単語にも対応しやすいのでword2vecといいつつfastTextの学習済みモデルを使うことにします。

こちらからNEologdの方をダウンロードします。

[https://qiita.com/Hironsan/items/513b9f93752ecee9e670](https://qiita.com/Hironsan/items/513b9f93752ecee9e670)

```
import gensim

model = gensim.models.KeyedVectors.load_word2vec_format('model.vec', binary=False)
print(model.similarity('国王', '王妃'))
```

結果。まあそこそこ類似している。

```
0.7415558764104452
```

## 単語リストから類似度が近い順に出力する

候補の単語リストから意味の近いが単語リストを出力する実装。

```
import gensim

model = gensim.models.KeyedVectors.load_word2vec_format('model.vec', binary=False)
print('model loaded')

input = '音楽'

entries = ['水', 'ピアノ', '歌', 'ネズミ', '山田', 'のだめ', 'ラーメン', 'チャーハン']
similarities = [model.similarity(input, entry) for entry in entries]


results = [[similarity, entry] for (entry, similarity) in zip(entries, similarities)]
print(sorted(results, reverse=True))
```

結果。

「音楽」と類似性のある単語なので、「ピアノ」「歌」が上位に来ます。面白いのは「のだめ」ですね。「のだめカンタービレ」の「のだめ」だと思うのですが、ちゃんと3位に入っててすごい。

```
model loaded
[[0.6169899229268544, 'ピアノ'], [0.4713573407607582, '歌'], [0.2292222342027308, 'のだめ'], [0.20652593259197552, 'チャーハン'], [0.1938283436807833, 'ラーメン'], [0.17242243144392436, 'ネズミ'], [0.13525180029671519, '水'], [0.11767428906901088, '山田']]
```

## 対話式にヒントを入力出来るようにする

fastTextのモデルは容量が大きいため、毎回モデルをロードしていると時間がかかってツラい。対話式にヒント文字列をインプットさせるように改善。


```
import gensim

model = gensim.models.KeyedVectors.load_word2vec_format('model.vec', binary=False)
print('model loaded')

entries = ['水', 'ピアノ', '歌', 'ネズミ', '山田', 'のだめ', 'ラーメン', 'チャーハン']

while True:
    hint = input("Please Enter Hint Word: ")
    similarities = [model.similarity(hint, entry) for entry in entries]
    results = [[similarity, entry] for (entry, similarity) in zip(entries, similarities)]
    print(sorted(results, reverse=True))
```

いくつか思いついた単語をインプットさせてみた。大体直感通りの結果が来ているように見える。「女の子」からの「ネズミ」は謎。ミニーか？ミニーなのか？

```
Please Enter Hint Word: ピアノ
[[1.0, 'ピアノ'], [0.43565867161470445, '歌'], [0.3320467465769171, 'のだめ'], [0.26950472594431163, 'チャーハン'], [0.19272638659128938, 'ラーメン'], [0.18938207555065334, 'ネズミ'], [0.1550712436945725, '山田'], [0.10224726495755349, '水']]

Please Enter Hint Word: 音楽
[[0.6169899229268544, 'ピアノ'], [0.4713573407607582, '歌'], [0.2292222342027308, 'のだめ'], [0.20652593259197552, 'チャーハン'], [0.1938283436807833, 'ラーメン'], [0.17242243144392436, 'ネズミ'], [0.13525180029671519, '水'], [0.11767428906901088, '山田']]

Please Enter Hint Word: 犬
[[0.5613603123122953, 'ネズミ'], [0.3226369348454945, 'チャーハン'], [0.2243613060427448, 'ラーメン'], [0.21535947962259477, '歌'], [0.20445501347267214, 'のだめ'], [0.18993679794265358, 'ピアノ'], [0.18400771550299977, '水'], [0.1777356578838234, '山田']]

Please Enter Hint Word: 中華
[[0.39156823156332166, 'ラーメン'], [0.3760020975907288, 'チャーハン'], [0.17497745854109759, '山田'], [0.1470604288216415, 'ネズミ'], [0.1367321315218868, '水'], [0.133490035235623, '歌'], [0.12712744795792122, 'ピアノ'], [0.11558425960228152, 'のだめ']]

Please Enter Hint Word: ご飯
[[0.6251783265716403, 'チャーハン'], [0.5756860064634584, 'ラーメン'], [0.32121973780734264, 'ネズミ'], [0.30025417864681714, '水'], [0.24296017247392815, 'のだめ'], [0.23776385035795294, 'ピアノ'], [0.21658843752440543, '歌'], [0.12862305947556246, '山田']]

Please Enter Hint Word: 女の子
[[0.4351578615781734, 'のだめ'], [0.3653867143383554, 'ネズミ'], [0.35502207264730345, '歌'], [0.3229137653972869, 'ピアノ'], [0.3139616192660859, 'チャーハン'], [0.2808129630522954, 'ラーメン'], [0.1665110543566241, '山田'], [0.13388873838939902, '水']]
```

## コードネームのカードに合わせて候補を修正

コードネームでは25枚のカードを並べるので、とりあえず適当にGoogle画像検索して出てきた25枚のカードの単語を入れておく。

[http://hobbyjapan.co.jp/game?attachment_id=11580](http://hobbyjapan.co.jp/game?attachment_id=11580)

アルプス
コミック
億万長者
ルール
飛行機
ルート
ライター
南極
パイロット
草原
靴下
手袋
モスクワ
レーザー
タップ
氷
カボチャ
トリップ
死
パーツ
イス
雪だるま
森
レース
ノート

`entries`の部分だけを修正。

```
entries = ['アルプス', 'コミック', '億万長者', 'ルール', '飛行機', 'ルート', 'ライター', '南極', 'パイロット', '草原', '靴下', '手袋', 'モスクワ', 'レーザー', 'タップ', '氷', 'カボチャ', 'トリップ', '死', 'パーツ', 'イス', '雪だるま', '森', 'レース', 'ノート']
```

この状況で、「海外」というヒントで「飛行機」と「南極」と「モスクワ」を当てたいとする。

やってみる。

```
Please Enter Hint Word: 海外
[[0.2652039376190187, '億万長者'], [0.2423529363055031, 'モスクワ'], [0.2302802390443617, '南極'], [0.22584301443358396, 'レース'], [0.21508693164279488, 'ライター'], [0.2126630599750537, 'パーツ'], [0.20409594764793076, '飛行機'], [0.18853815636993165, 'コミック'], [0.1797889052083787, 'トリップ'], [0.17823215055840946, 'レーザー'], [0.16019663678811671, 'パイロット'], [0.15045440960752246, 'ノート'], [0.1491811526597114, 'ルール'], [0.14693725258557108, 'アルプス'], [0.14678200418773513, '靴下'], [0.13754995885115084, 'ルート'], [0.1121549481165682, 'タップ'], [0.10258050183270567, '手袋'], [0.09644947898167762, '草原'], [0.0889428734420587, '氷'], [0.08442313357454047, 'カボチャ'], [0.07666276056588606, 'イス'], [0.06462464366401303, '森'], [0.020523827709298982, '死'], [-0.006318696251227121, '雪だるま']]
```

億万長者、モスクワ、南極ときた。惜しい。確かに億万長者はしょっちゅう海外旅行とかしてそうだわ。

意外にも飛行機は低い。よくよく見たら「トリップ」もあるけど9位かー。


## 人 vs word2vec
実際にコードネームを人 vs word2vecでやってみます。

(後ほど追記します)
